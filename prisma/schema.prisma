// OpportuneX Prisma Schema
// This schema defines the database structure for the OpportuneX platform

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum OpportunityType {
  hackathon
  internship
  workshop
}

enum OrganizerType {
  corporate
  startup
  government
  academic
}

enum OpportunityMode {
  online
  offline
  hybrid
}

enum ProficiencyLevel {
  beginner
  intermediate
  advanced
}

enum NotificationFrequency {
  immediate
  daily
  weekly
}

enum NotificationType {
  new_opportunities
  deadlines
  recommendations
}

// User model
model User {
  id                        String                 @id @default(uuid()) @db.Uuid
  email                     String                 @unique @db.VarChar(255)
  name                      String                 @db.VarChar(100)
  phone                     String?                @db.VarChar(15)
  passwordHash              String                 @map("password_hash") @db.VarChar(255)
  city                      String?                @db.VarChar(100)
  state                     String?                @db.VarChar(100)
  tier                      Int?                   @db.Integer
  institution               String?                @db.VarChar(200)
  degree                    String?                @db.VarChar(100)
  year                      Int?                   @db.Integer
  cgpa                      Decimal?               @db.Decimal(3, 2)
  technicalSkills           String[]               @map("technical_skills")
  domains                   String[]
  proficiencyLevel          ProficiencyLevel       @default(beginner) @map("proficiency_level")
  preferredOpportunityTypes OpportunityType[]      @map("preferred_opportunity_types")
  preferredMode             OpportunityMode?       @default(online) @map("preferred_mode")
  maxDistance               Int?                   @map("max_distance") @db.Integer
  emailNotifications        Boolean                @default(true) @map("email_notifications")
  smsNotifications          Boolean                @default(false) @map("sms_notifications")
  inAppNotifications        Boolean                @default(true) @map("in_app_notifications")
  notificationFrequency     NotificationFrequency  @default(daily) @map("notification_frequency")
  notificationTypes         NotificationType[]     @map("notification_types")
  preferredLanguage         String                 @default("en") @map("preferred_language") @db.VarChar(5)
  createdAt                 DateTime               @default(now()) @map("created_at") @db.Timestamptz
  updatedAt                 DateTime               @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  searches         UserSearch[]
  favorites        UserFavorite[]
  notifications    Notification[]
  roadmaps         Roadmap[]
  followers        UserFollow[]     @relation("UserFollowing")
  following        UserFollow[]     @relation("UserFollowers")
  activities       ActivityFeed[]
  discussions      Discussion[]
  comments         Comment[]
  createdTeams     Team[]
  teamMemberships  TeamMember[]
  sentMessages     DirectMessage[]  @relation("SentMessages")
  receivedMessages DirectMessage[]  @relation("ReceivedMessages")
  sharedContent          SharedContent[]          @relation("SharedByUser")
  receivedShares         SharedContent[]          @relation("SharedWithUser")
  apiKeys                ApiKey[]
  webhooks               Webhook[]
  oauthClients           OAuthClient[]
  oauthAuthorizationCodes OAuthAuthorizationCode[]
  oauthAccessTokens      OAuthAccessToken[]
  blockchainWallet       UserBlockchain?
  credentials            Credential[]
  blockchainTransactions BlockchainTransaction[]

  @@map("users")
}

// Opportunity model
model Opportunity {
  id                   String          @id @default(uuid()) @db.Uuid
  title                String          @db.VarChar(500)
  description          String?
  type                 OpportunityType
  organizerName        String          @map("organizer_name") @db.VarChar(200)
  organizerType        OrganizerType   @map("organizer_type")
  organizerLogo        String?         @map("organizer_logo") @db.VarChar(500)
  requiredSkills       String[]        @map("required_skills")
  experienceRequired   String?         @map("experience_required") @db.VarChar(200)
  educationRequired    String?         @map("education_required") @db.VarChar(200)
  eligibilityCriteria  String[]        @map("eligibility_criteria")
  mode                 OpportunityMode
  location             String?         @db.VarChar(200)
  duration             String?         @db.VarChar(100)
  stipend              String?         @db.VarChar(100)
  prizes               String[]
  applicationDeadline  DateTime        @map("application_deadline") @db.Timestamptz
  startDate            DateTime?       @map("start_date") @db.Timestamptz
  endDate              DateTime?       @map("end_date") @db.Timestamptz
  externalUrl          String          @map("external_url") @db.VarChar(1000)
  sourceId             String          @map("source_id") @db.VarChar(100)
  tags                 String[]
  isActive             Boolean         @default(true) @map("is_active")
  qualityScore         Int             @default(0) @map("quality_score") @db.Integer
  createdAt            DateTime        @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime        @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  source        Source         @relation(fields: [sourceId], references: [id])
  favorites     UserFavorite[]
  notifications Notification[]
  roadmaps      Roadmap[]
  credentials   Credential[]

  @@map("opportunities")
}

// Source model
model Source {
  id                   String    @id @db.VarChar(100)
  name                 String    @db.VarChar(200)
  url                  String    @db.VarChar(500)
  type                 String    @db.VarChar(50)
  isActive             Boolean   @default(true) @map("is_active")
  lastScrapedAt        DateTime? @map("last_scraped_at") @db.Timestamptz
  scrapeFrequencyHours Int       @default(24) @map("scrape_frequency_hours") @db.Integer
  qualityScore         Int       @default(0) @map("quality_score") @db.Integer
  createdAt            DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  opportunities Opportunity[]

  @@map("sources")
}

// User search model
model UserSearch {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String?  @map("user_id") @db.Uuid
  query       String
  filters     Json?
  resultCount Int      @default(0) @map("result_count") @db.Integer
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_searches")
}

// User favorites model
model UserFavorite {
  id            String   @id @default(uuid()) @db.Uuid
  userId        String   @map("user_id") @db.Uuid
  opportunityId String   @map("opportunity_id") @db.Uuid
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  opportunity Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@unique([userId, opportunityId])
  @@map("user_favorites")
}

// Notification model
model Notification {
  id            String           @id @default(uuid()) @db.Uuid
  userId        String           @map("user_id") @db.Uuid
  type          NotificationType
  title         String           @db.VarChar(200)
  message       String
  opportunityId String?          @map("opportunity_id") @db.Uuid
  isRead        Boolean          @default(false) @map("is_read")
  sentAt        DateTime?        @map("sent_at") @db.Timestamptz
  createdAt     DateTime         @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  opportunity Opportunity? @relation(fields: [opportunityId], references: [id], onDelete: SetNull)

  @@map("notifications")
}

// Roadmap model
model Roadmap {
  id                String   @id @default(uuid()) @db.Uuid
  userId            String   @map("user_id") @db.Uuid
  opportunityId     String   @map("opportunity_id") @db.Uuid
  title             String   @db.VarChar(200)
  description       String?
  phases            Json
  estimatedDuration Int?     @map("estimated_duration") @db.Integer
  targetDate        DateTime? @map("target_date") @db.Timestamptz
  isActive          Boolean  @default(true) @map("is_active")
  isPublic          Boolean  @default(false) @map("is_public")
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt         DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  opportunity Opportunity @relation(fields: [opportunityId], references: [id], onDelete: Cascade)

  @@map("roadmaps")
}

// User Follow model
model UserFollow {
  id          String   @id @default(uuid()) @db.Uuid
  followerId  String   @map("follower_id") @db.Uuid
  followingId String   @map("following_id") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  follower  User @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowing", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("user_follows")
}

// Activity Feed model
model ActivityFeed {
  id            String       @id @default(uuid()) @db.Uuid
  userId        String       @map("user_id") @db.Uuid
  activityType  ActivityType @map("activity_type")
  entityId      String       @map("entity_id") @db.Uuid
  entityType    String       @map("entity_type") @db.VarChar(50)
  metadata      Json?
  createdAt     DateTime     @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@map("activity_feeds")
}

enum ActivityType {
  saved_opportunity
  completed_roadmap
  joined_team
  shared_opportunity
  completed_milestone
}

// Discussion Forum model
model Discussion {
  id            String   @id @default(uuid()) @db.Uuid
  opportunityId String   @map("opportunity_id") @db.Uuid
  userId        String   @map("user_id") @db.Uuid
  title         String   @db.VarChar(200)
  content       String
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  comments Comment[]

  @@index([opportunityId, createdAt])
  @@map("discussions")
}

// Comment model
model Comment {
  id           String   @id @default(uuid()) @db.Uuid
  discussionId String   @map("discussion_id") @db.Uuid
  userId       String   @map("user_id") @db.Uuid
  content      String
  parentId     String?  @map("parent_id") @db.Uuid
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  discussion Discussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent     Comment?   @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies    Comment[]  @relation("CommentReplies")

  @@index([discussionId, createdAt])
  @@map("comments")
}

// Team model
model Team {
  id            String   @id @default(uuid()) @db.Uuid
  name          String   @db.VarChar(100)
  description   String?
  opportunityId String?  @map("opportunity_id") @db.Uuid
  creatorId     String   @map("creator_id") @db.Uuid
  maxMembers    Int      @default(5) @map("max_members") @db.Integer
  isPublic      Boolean  @default(true) @map("is_public")
  isActive      Boolean  @default(true) @map("is_active")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  creator User         @relation(fields: [creatorId], references: [id], onDelete: Cascade)
  members TeamMember[]

  @@map("teams")
}

// Team Member model
model TeamMember {
  id        String         @id @default(uuid()) @db.Uuid
  teamId    String         @map("team_id") @db.Uuid
  userId    String         @map("user_id") @db.Uuid
  role      TeamMemberRole @default(member)
  joinedAt  DateTime       @default(now()) @map("joined_at") @db.Timestamptz

  // Relations
  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@map("team_members")
}

enum TeamMemberRole {
  admin
  member
}

// Direct Message model
model DirectMessage {
  id         String   @id @default(uuid()) @db.Uuid
  senderId   String   @map("sender_id") @db.Uuid
  receiverId String   @map("receiver_id") @db.Uuid
  content    String
  isRead     Boolean  @default(false) @map("is_read")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  sender   User @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([senderId, receiverId, createdAt])
  @@map("direct_messages")
}

// Shared Content model
model SharedContent {
  id           String      @id @default(uuid()) @db.Uuid
  userId       String      @map("user_id") @db.Uuid
  contentType  ContentType @map("content_type")
  contentId    String      @map("content_id") @db.Uuid
  sharedWithId String?     @map("shared_with_id") @db.Uuid
  message      String?
  isPublic     Boolean     @default(false) @map("is_public")
  createdAt    DateTime    @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  user       User  @relation("SharedByUser", fields: [userId], references: [id], onDelete: Cascade)
  sharedWith User? @relation("SharedWithUser", fields: [sharedWithId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@map("shared_contents")
}

enum ContentType {
  opportunity
  roadmap
}

// Multilingual Content model
model OpportunityTranslation {
  id            String   @id @default(uuid()) @db.Uuid
  opportunityId String   @map("opportunity_id") @db.Uuid
  language      String   @db.VarChar(5)
  title         String   @db.VarChar(500)
  description   String?
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@unique([opportunityId, language])
  @@index([language])
  @@map("opportunity_translations")
}

// API Key model for third-party integrations
model ApiKey {
  id               String         @id @default(uuid()) @db.Uuid
  userId           String         @map("user_id") @db.Uuid
  name             String         @db.VarChar(100)
  keyHash          String         @unique @map("key_hash") @db.VarChar(255)
  keyPrefix        String         @map("key_prefix") @db.VarChar(20)
  scopes           String[]
  rateLimit        Int            @default(1000) @map("rate_limit") @db.Integer
  rateLimitWindow  Int            @default(3600) @map("rate_limit_window") @db.Integer
  isActive         Boolean        @default(true) @map("is_active")
  lastUsedAt       DateTime?      @map("last_used_at") @db.Timestamptz
  expiresAt        DateTime?      @map("expires_at") @db.Timestamptz
  createdAt        DateTime       @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime       @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  webhooks  Webhook[]
  usageLogs ApiUsageLog[]

  @@index([userId])
  @@index([keyHash])
  @@map("api_keys")
}

// Webhook model
model Webhook {
  id               String             @id @default(uuid()) @db.Uuid
  userId           String             @map("user_id") @db.Uuid
  apiKeyId         String             @map("api_key_id") @db.Uuid
  url              String             @db.VarChar(500)
  events           String[]
  secret           String             @db.VarChar(255)
  isActive         Boolean            @default(true) @map("is_active")
  retryCount       Int                @default(3) @map("retry_count") @db.Integer
  timeoutMs        Int                @default(5000) @map("timeout_ms") @db.Integer
  lastTriggeredAt  DateTime?          @map("last_triggered_at") @db.Timestamptz
  createdAt        DateTime           @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime           @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user       User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  apiKey     ApiKey             @relation(fields: [apiKeyId], references: [id], onDelete: Cascade)
  deliveries WebhookDelivery[]

  @@index([userId])
  @@index([apiKeyId])
  @@map("webhooks")
}

// Webhook Delivery Log model
model WebhookDelivery {
  id             String    @id @default(uuid()) @db.Uuid
  webhookId      String    @map("webhook_id") @db.Uuid
  eventType      String    @map("event_type") @db.VarChar(100)
  payload        Json
  responseStatus Int?      @map("response_status") @db.Integer
  responseBody   String?   @map("response_body")
  errorMessage   String?   @map("error_message")
  attemptCount   Int       @default(1) @map("attempt_count") @db.Integer
  deliveredAt    DateTime? @map("delivered_at") @db.Timestamptz
  createdAt      DateTime  @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  webhook Webhook @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId])
  @@map("webhook_deliveries")
}

// API Usage Log model
model ApiUsageLog {
  id             String   @id @default(uuid()) @db.Uuid
  apiKeyId       String   @map("api_key_id") @db.Uuid
  endpoint       String   @db.VarChar(200)
  method         String   @db.VarChar(10)
  statusCode     Int      @map("status_code") @db.Integer
  responseTimeMs Int      @map("response_time_ms") @db.Integer
  ipAddress      String?  @map("ip_address") @db.VarChar(45)
  userAgent      String?  @map("user_agent")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  apiKey ApiKey @relation(fields: [apiKeyId], references: [id], onDelete: Cascade)

  @@index([apiKeyId])
  @@index([createdAt])
  @@map("api_usage_logs")
}

// OAuth Client model
model OAuthClient {
  id               String                   @id @default(uuid()) @db.Uuid
  userId           String                   @map("user_id") @db.Uuid
  clientId         String                   @unique @map("client_id") @db.VarChar(100)
  clientSecretHash String                   @map("client_secret_hash") @db.VarChar(255)
  name             String                   @db.VarChar(100)
  description      String?
  redirectUris     String[]                 @map("redirect_uris")
  scopes           String[]
  isActive         Boolean                  @default(true) @map("is_active")
  createdAt        DateTime                 @default(now()) @map("created_at") @db.Timestamptz
  updatedAt        DateTime                 @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user              User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  authorizationCodes OAuthAuthorizationCode[]
  accessTokens      OAuthAccessToken[]

  @@index([userId])
  @@map("oauth_clients")
}

// OAuth Authorization Code model
model OAuthAuthorizationCode {
  id          String   @id @default(uuid()) @db.Uuid
  code        String   @unique @db.VarChar(255)
  clientId    String   @map("client_id") @db.VarChar(100)
  userId      String   @map("user_id") @db.Uuid
  redirectUri String   @map("redirect_uri") @db.VarChar(500)
  scopes      String[]
  expiresAt   DateTime @map("expires_at") @db.Timestamptz
  used        Boolean  @default(false)
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  client OAuthClient @relation(fields: [clientId], references: [clientId], onDelete: Cascade)
  user   User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([code])
  @@map("oauth_authorization_codes")
}

// OAuth Access Token model
model OAuthAccessToken {
  id        String   @id @default(uuid()) @db.Uuid
  tokenHash String   @unique @map("token_hash") @db.VarChar(255)
  clientId  String   @map("client_id") @db.VarChar(100)
  userId    String   @map("user_id") @db.Uuid
  scopes    String[]
  expiresAt DateTime @map("expires_at") @db.Timestamptz
  revoked   Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  client        OAuthClient        @relation(fields: [clientId], references: [clientId], onDelete: Cascade)
  user          User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  refreshTokens OAuthRefreshToken[]

  @@index([tokenHash])
  @@map("oauth_access_tokens")
}

// OAuth Refresh Token model
model OAuthRefreshToken {
  id            String   @id @default(uuid()) @db.Uuid
  tokenHash     String   @unique @map("token_hash") @db.VarChar(255)
  accessTokenId String   @map("access_token_id") @db.Uuid
  expiresAt     DateTime @map("expires_at") @db.Timestamptz
  revoked       Boolean  @default(false)
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  accessToken OAuthAccessToken @relation(fields: [accessTokenId], references: [id], onDelete: Cascade)

  @@index([tokenHash])
  @@map("oauth_refresh_tokens")
}

// Blockchain Verification Models

// User blockchain wallet
model UserBlockchain {
  id                   String   @id @default(uuid()) @db.Uuid
  userId               String   @unique @map("user_id") @db.Uuid
  address              String   @unique @db.VarChar(42)
  encryptedPrivateKey  String   @map("encrypted_private_key")
  createdAt            DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt            DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_blockchain")
}

// Blockchain credentials
model Credential {
  id            String    @id @default(uuid()) @db.Uuid
  userId        String    @map("user_id") @db.Uuid
  opportunityId String?   @map("opportunity_id") @db.Uuid
  credentialType String   @map("credential_type") @db.VarChar(50)
  blockchainId  String    @unique @map("blockchain_id") @db.VarChar(66)
  metadataUri   String    @map("metadata_uri")
  transactionHash String  @map("transaction_hash") @db.VarChar(66)
  issuedAt      DateTime  @default(now()) @map("issued_at") @db.Timestamptz
  expiresAt     DateTime? @map("expires_at") @db.Timestamptz
  revokedAt     DateTime? @map("revoked_at") @db.Timestamptz
  status        String    @default("active") @db.VarChar(20)
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt     DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  opportunity Opportunity? @relation(fields: [opportunityId], references: [id], onDelete: SetNull)
  shares      CredentialShare[]

  @@index([userId])
  @@index([opportunityId])
  @@index([blockchainId])
  @@index([status])
  @@map("credentials")
}

// Credential sharing
model CredentialShare {
  id           String   @id @default(uuid()) @db.Uuid
  credentialId String   @map("credential_id") @db.Uuid
  shareToken   String   @unique @map("share_token") @db.VarChar(64)
  viewCount    Int      @default(0) @map("view_count")
  expiresAt    DateTime @map("expires_at") @db.Timestamptz
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  credential Credential @relation(fields: [credentialId], references: [id], onDelete: Cascade)

  @@index([credentialId])
  @@index([shareToken])
  @@map("credential_shares")
}

// Blockchain transaction tracking
model BlockchainTransaction {
  id              String    @id @default(uuid()) @db.Uuid
  userId          String    @map("user_id") @db.Uuid
  transactionHash String    @unique @map("transaction_hash") @db.VarChar(66)
  transactionType String    @map("transaction_type") @db.VarChar(50)
  status          String    @default("pending") @db.VarChar(20)
  blockNumber     BigInt?   @map("block_number")
  gasUsed         BigInt?   @map("gas_used")
  errorMessage    String?   @map("error_message")
  metadata        Json?
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt       DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([transactionHash])
  @@index([status])
  @@map("blockchain_transactions")
}

// Virtual Events and AR/VR Models

// Virtual Event Space
model VirtualEventSpace {
  id              String   @id @default(uuid()) @db.Uuid
  opportunityId   String?  @map("opportunity_id") @db.Uuid
  name            String   @db.VarChar(200)
  description     String?
  spaceType       String   @map("space_type") @db.VarChar(50)
  maxParticipants Int      @default(100) @map("max_participants")
  sceneConfig     Json     @map("scene_config")
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt       DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  sessions      VirtualEventSession[]
  booths        VirtualBooth[]
  presentations VirtualPresentation[]
  audioChannels SpatialAudioChannel[]
  interactions  VirtualInteraction[]
  cardExchanges ArCardExchange[]

  @@index([opportunityId])
  @@index([isActive])
  @@map("virtual_event_spaces")
}

// User Avatar
model UserAvatar {
  id           String   @id @default(uuid()) @db.Uuid
  userId       String   @unique @map("user_id") @db.Uuid
  avatarConfig Json     @map("avatar_config")
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt    DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([userId])
  @@map("user_avatars")
}

// Virtual Event Session
model VirtualEventSession {
  id           String    @id @default(uuid()) @db.Uuid
  spaceId      String    @map("space_id") @db.Uuid
  userId       String    @map("user_id") @db.Uuid
  sessionToken String    @unique @map("session_token") @db.VarChar(255)
  position     Json?
  rotation     Json?
  isActive     Boolean   @default(true) @map("is_active")
  joinedAt     DateTime  @default(now()) @map("joined_at") @db.Timestamptz
  leftAt       DateTime? @map("left_at") @db.Timestamptz
  createdAt    DateTime  @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  space VirtualEventSpace @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  @@index([spaceId])
  @@index([userId])
  @@index([isActive])
  @@map("virtual_event_sessions")
}

// Virtual Booth
model VirtualBooth {
  id          String   @id @default(uuid()) @db.Uuid
  spaceId     String   @map("space_id") @db.Uuid
  companyName String   @map("company_name") @db.VarChar(200)
  boothConfig Json     @map("booth_config")
  position    Json
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  space VirtualEventSpace @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  @@index([spaceId])
  @@index([isActive])
  @@map("virtual_booths")
}

// AR Business Card
model ArBusinessCard {
  id         String   @id @default(uuid()) @db.Uuid
  userId     String   @map("user_id") @db.Uuid
  cardData   Json     @map("card_data")
  qrCodeUrl  String?  @map("qr_code_url") @db.VarChar(500)
  arMarkerId String?  @unique @map("ar_marker_id") @db.VarChar(100)
  shareCount Int      @default(0) @map("share_count")
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  exchanges ArCardExchange[]

  @@index([userId])
  @@index([arMarkerId])
  @@map("ar_business_cards")
}

// AR Card Exchange
model ArCardExchange {
  id          String    @id @default(uuid()) @db.Uuid
  senderId    String    @map("sender_id") @db.Uuid
  receiverId  String    @map("receiver_id") @db.Uuid
  cardId      String    @map("card_id") @db.Uuid
  spaceId     String?   @map("space_id") @db.Uuid
  exchangedAt DateTime  @default(now()) @map("exchanged_at") @db.Timestamptz

  // Relations
  card  ArBusinessCard      @relation(fields: [cardId], references: [id], onDelete: Cascade)
  space VirtualEventSpace?  @relation(fields: [spaceId], references: [id], onDelete: SetNull)

  @@index([senderId])
  @@index([receiverId])
  @@index([spaceId])
  @@map("ar_card_exchanges")
}

// Virtual Presentation
model VirtualPresentation {
  id          String    @id @default(uuid()) @db.Uuid
  spaceId     String    @map("space_id") @db.Uuid
  presenterId String    @map("presenter_id") @db.Uuid
  title       String    @db.VarChar(200)
  description String?
  contentUrl  String?   @map("content_url") @db.VarChar(500)
  contentType String?   @map("content_type") @db.VarChar(50)
  scheduledAt DateTime? @map("scheduled_at") @db.Timestamptz
  startedAt   DateTime? @map("started_at") @db.Timestamptz
  endedAt     DateTime? @map("ended_at") @db.Timestamptz
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz
  updatedAt   DateTime  @updatedAt @map("updated_at") @db.Timestamptz

  // Relations
  space VirtualEventSpace @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  @@index([spaceId])
  @@index([presenterId])
  @@index([scheduledAt])
  @@map("virtual_presentations")
}

// Spatial Audio Channel
model SpatialAudioChannel {
  id          String   @id @default(uuid()) @db.Uuid
  spaceId     String   @map("space_id") @db.Uuid
  channelName String   @map("channel_name") @db.VarChar(100)
  channelType String   @map("channel_type") @db.VarChar(50)
  maxDistance Decimal? @map("max_distance") @db.Decimal(10, 2)
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  space VirtualEventSpace @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  @@index([spaceId])
  @@index([isActive])
  @@map("spatial_audio_channels")
}

// Virtual Interaction
model VirtualInteraction {
  id              String   @id @default(uuid()) @db.Uuid
  spaceId         String   @map("space_id") @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  interactionType String   @map("interaction_type") @db.VarChar(50)
  targetId        String?  @map("target_id") @db.Uuid
  metadata        Json?
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz

  // Relations
  space VirtualEventSpace @relation(fields: [spaceId], references: [id], onDelete: Cascade)

  @@index([spaceId])
  @@index([userId])
  @@index([interactionType])
  @@map("virtual_interactions")
}

// User Device Capabilities
model UserDeviceCapability {
  id              String   @id @default(uuid()) @db.Uuid
  userId          String   @map("user_id") @db.Uuid
  supportsWebxr   Boolean  @default(false) @map("supports_webxr")
  supportsAr      Boolean  @default(false) @map("supports_ar")
  supportsVr      Boolean  @default(false) @map("supports_vr")
  deviceType      String?  @map("device_type") @db.VarChar(50)
  performanceTier String?  @map("performance_tier") @db.VarChar(20)
  lastDetectedAt  DateTime @default(now()) @map("last_detected_at") @db.Timestamptz
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz
  updatedAt       DateTime @updatedAt @map("updated_at") @db.Timestamptz

  @@index([userId])
  @@map("user_device_capabilities")
}
